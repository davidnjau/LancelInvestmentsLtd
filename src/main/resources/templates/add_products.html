<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <title>Lancel Investment Ltd</title>

    <!-- Font Icon -->
    <link rel="stylesheet" th:href="@{/fonts/material-icon/css/material-design-iconic-font.min.css}">
    <link rel="stylesheet" th:href="@{/vendor/nouislider/nouislider.min.css}">

    <!-- Main css -->
    <link rel="stylesheet" th:href="@{/static/assets/admin/assets/table/css/style.css}">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</head>
<body>


<div class="container-scroller">

    <div class="container-fluid page-body-wrapper">

        <!-- partial:../../partials/_sidebar.html -->
        <div data-th-include="sidebar.html"></div>

        <!-- partial -->
        <div class="main-panel">
            <div class="content-wrapper">
                <div class="row">
                    <div class="col-md-6 grid-margin stretch-card">

                    </div>
                    <div class="col-md-6 grid-margin stretch-card">
                        <div class="card">

                        </div>
                    </div>
                    <div class="col-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">Product Details</h4>
                                <p class="card-description">
                                    Product Details
                                </p>
                                <div class="forms-sample">
                                    <div class="form-group">
                                        <label for="productName">Product Name</label>
                                        <input type="text" class="form-control" id="productName" placeholder="Product Name">
                                    </div>
                                    <div class="form-group">
                                        <label for="productDescription">Product Description</label>
                                        <textarea class="form-control" id="productDescription" rows="7"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="productIngredients">Product Ingredients</label>
                                        <input type="text" class="form-control" id="productIngredients" placeholder="Product Ingredients">
                                    </div>

                                    <div id="actionButtons">
                                        <button onclick="uploadDetails()" class="btn btn-primary me-2">Submit</button>
                                        <button class="btn btn-light">Cancel</button>
                                    </div>


                                </div>

                                <div id="imageUpload" class="form-group">
                                    <label>Image upload</label>

                                    <div class="col-6 mt-3">

                                        <input type="file" id="image1" name="image1" class="file-upload-default">
                                        <div class="input-group col-xs-12">
                                            <input type="text" class="form-control file-upload-info" disabled placeholder="Browse Image">
                                            <span class="input-group-append">
                                                <button class="file-upload-browse btn btn-primary" type="button">Browse</button>
                                            </span>
                                        </div>

                                    </div>
                                    <div class="col-6 mt-3">

                                        <input type="file" id="image2" name="image2" class="file-upload-default">
                                        <div class="input-group col-xs-12">
                                            <input type="text" class="form-control file-upload-info" disabled placeholder="Browse Image">
                                            <span class="input-group-append">
                                                <button class="file-upload-browse btn btn-primary" type="button">Browse</button>
                                            </span>
                                        </div>

                                    </div>
                                    <div class="col-6 mt-3">

                                        <input type="file" id="image3" name="image3" class="file-upload-default">
                                        <div class="input-group col-xs-12">
                                            <input type="text" class="form-control file-upload-info" disabled placeholder="Browse Image">
                                            <span class="input-group-append">
                                                <button class="file-upload-browse btn btn-primary" type="button">Browse</button>
                                            </span>
                                        </div>

                                    </div>

                                    <button onclick="uploadImages()" class="mt-3 btn btn-primary me-2">Upload Images</button>


                                </div>

                                <div id="sizeAmount" class="form-group" >

                                    <label>Product Prices and Sizes</label>

                                    <div>
                                        <button type="button" class="mb-3 btn btn-primary" data-toggle="modal" data-target="#exampleModal"> Add Product Size</button>

                                    </div>

                                    <div class="col-lg-12 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <p class="card-description">
                                                </p>
                                                <div class="table-responsive pt-3">

                                                    <table id="sizesTable" class="table table-bordered" >
                                                        <thead>
                                                        <tr>
                                                            <th>Product Size</th>
                                                            <th>Size Unit (g/kg)</th>
                                                            <th>New Price</th>
                                                            <th>Old Price</th>
                                                            <th>Stock Number</th>
                                                            <th>Action</th>
                                                        </tr>
                                                        </thead>

                                                        <tbody>

                                                        </tbody>

                                                    </table>

                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>

                            </div>
                        </div>
                    </div>




                </div>
            </div>
            <!-- content-wrapper ends -->
            <!-- partial:../../partials/_footer.html -->
            <footer class="footer">
                <div class="d-sm-flex justify-content-center justify-content-sm-between">
                    <span class="text-muted text-center text-sm-left d-block d-sm-inline-block"> <a href="https://www.centafrique.com/" target="_blank">Lancel admin dashboard</a> from Centafrique.</span>
                    <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">Copyright Â© 2021. All rights reserved.</span>
                </div>
            </footer>
            <!-- partial -->
        </div>
        <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
</div>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Product Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div>

                    <div class="row">

                        <div class="form-group col-4">
                            <label for="productSize">Size</label>
                            <input type="number" class="form-control" id="productSize" placeholder="Product Size">
                        </div>

                        <div class="form-group col-4">
                            <label for="productUnit">Unit</label>
                            <input type="text" class="form-control" id="productUnit" placeholder="Unit(g/kg)">
                        </div>

                        <div class="form-group col-4">
                            <label for="productStockNo">Stock Number</label>
                            <input type="number" class="form-control" id="productStockNo" placeholder="Stock">
                        </div>

                    </div>

                    <div class="row">

                        <div class="form-group col-6">
                            <label for="productNewPrice">Product New Price</label>
                            <input type="number" class="form-control" id="productNewPrice" placeholder="New Price">
                        </div>

                        <div class="form-group col-6">
                            <label for="productOldPrice">Product Old Price</label>
                            <input type="number" class="form-control" id="productOldPrice" placeholder="Old Price">
                        </div>

                    </div>



                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button class="btn btn-primary btn-lg" onclick="SaveSizePrice()">Save</button>

            </div>
        </div>
    </div>
</div>

<script th:src="@{/static/assets/admin/assets/js/file-upload.js}"></script>

</body>

<script>

    document.getElementById("imageUpload").style.display = "none";
    document.getElementById("sizeAmount").style.display = "none";
    let productId = window.localStorage.getItem('productId');

    function uploadImages(){

        let productId = window.localStorage.getItem('productId');

        let formData = new FormData()
        let image1 = $('#image1')[0].files[0]
        let image2 = $('#image2')[0].files[0]
        let image3 = $('#image3')[0].files[0]

        formData.append('file1', image1);
        formData.append('file2', image2);
        formData.append('file3', image3);
        formData.append('productId', productId);

        $.ajax({
            method: 'POST',
            url: "/api/v1/products/add_product_images",
            enctype: 'multipart/form-data',
            data: formData,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 600000,
            // contentType: "application/json",
            // dataType: 'json',
            success: function(response) {

                alert("Successfully Saved images.")

                // new swal(
                //     'Product images saved successfully',
                //     'Images saved successfully.',
                //     'success'
                // )



            }, error: function (error) {
                alert('error: ' + error);
                console.log("-*-*-* "+ error)

                // let json = $.parseJSON(error.responseText);
                // let details = json.error
                //
                // new swal({
                //     icon: 'error',
                //     title: 'Oops...',
                //     text: details,
                // })
            }

        })




    }

    //Add Product details
    function uploadDetails(){

        let productName = document.getElementById("productName").value;
        let productDescription = document.getElementById("productDescription").value;
        let productIngredients = document.getElementById("productIngredients").value;

        if (productName && productDescription && productIngredients){

            let dataJson = {
                "productName": productName,
                "productDescription": productDescription,
                "productIngredients": productIngredients,
            };
            let postData = JSON.stringify(dataJson);

            $.ajax({
                type: 'POST',
                url: "/api/v1/add_products_details",
                data: postData,
                success: function(response) {

                    var productId = response.id
                    window.localStorage.setItem('productId', productId);

                    alert("Please add product images and product sizes.")
                    document.getElementById("imageUpload").style.display = "block";
                    document.getElementById("sizeAmount").style.display = "block";
                    document.getElementById("actionButtons").style.display = "none";

                    // new swal(
                    //     'Products saved successfully',
                    //     'Please add product images and product sizes.',
                    //     'success'
                    // )



                }, error: function (error) {
                    // alert('error: ' + error);

                    let json = $.parseJSON(error.responseText);
                    let details = json.error



                    alert(json)


                    new swal({
                        icon: 'error',
                        title: 'Oops...',
                        text: details,
                    })
                },
                contentType: "application/json",
                dataType: 'json'

            })



        }else {

            alert("Make sure all the fields are filled.")

            new swal({
                title: "error",
                text: "Make sure all the fields are filled.",
                icon: "error",
            });
        }

    }

    function appendObjTo(thatArray, newObj) {
        const frozenObj = Object.freeze(newObj);
        return Object.freeze(thatArray.concat(frozenObj));
    }

    function SaveSizePrice(){

        // window.localStorage.removeItem('sizeAmountList');
        let productId = window.localStorage.getItem('productId');

        let productSize = document.getElementById("productSize").value;
        let productUnit = document.getElementById("productUnit").value;
        let productStockNo = document.getElementById("productStockNo").value;
        let productNewPrice = document.getElementById("productNewPrice").value;
        let productOldPrice = document.getElementById("productOldPrice").value;

        if (productSize && productUnit && productStockNo && productNewPrice && productOldPrice){

            let dataJson = {
                "productId": productId,
                "sizeAmount": productSize,
                "sizeUnit": productUnit,
                "stockNumber": productStockNo,
                "newPrice": productNewPrice,
                "oldPrice": productOldPrice
            };

            let postData = JSON.stringify(dataJson);

            $.ajax({
                type: 'POST',
                url: "/api/v1/products/add_product_sizes",
                data: postData,
                success: function(response) {

                    alert("Saved the product size and amounts.")

                    getSizes();

                    // new swal(
                    //     'Products saved successfully',
                    //     'Please add product images and product sizes.',
                    //     'success'
                    // )



                }, error: function (error) {
                    // alert('error: ' + error);

                    let json = $.parseJSON(error.responseText);
                    let details = json.error
                    alert("Cannot save product sizes.")

                    new swal({
                        icon: 'error',
                        title: 'Oops...',
                        text: details,
                    });
                },
                contentType: "application/json",
                dataType: 'json'
            })

        }else {

            alert("Fill in all the fields.");
        }

    }

    function getSizes(){

        let productId = window.localStorage.getItem('productId');
        $.ajax({
            type: 'GET',
            url: "/api/v1/products/view_sizes/" + productId,
            success: function(response) {

                let sizesTable = document.getElementById("sizesTable");
                let row = sizesTable.insertRow(1);

                let cell1 = row.insertCell(0);
                let cell2 = row.insertCell(1);
                let cell3 = row.insertCell(2);
                let cell4 = row.insertCell(3);
                let cell5 = row.insertCell(4);
                let cell6 = row.insertCell(5);

                for (let i = 0; i < response.length; i++){

                    let sizeAmount = response[i].sizeAmount
                    let sizeUnit = response[i].sizeUnit
                    let newPrice = response[i].newPrice
                    let oldPrice = response[i].oldPrice
                    let stockNumber = response[i].stockNumber

                    cell1.innerHTML = sizeAmount;
                    cell2.innerHTML = sizeUnit;
                    cell3.innerHTML = newPrice;
                    cell4.innerHTML = oldPrice;
                    cell5.innerHTML = stockNumber;

                }


            }, error: function (error) {
                alert('error: ' + error);
            }

        })


    }

</script>


</html>